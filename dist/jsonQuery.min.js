/*! jsonQuery 11-03-2014 */
"use strict";!function(a,b){"object"==typeof module&&module.exports&&(module.exports=b(a)),"function"==typeof define&&define.amd&&define(function(){return b(a)}),a.JsonQuery=b(a)}(this,function(){var a=function(a){this.data=a||{},this.properties=null,this.root=a||{}},b=function(a,b){1===arguments.length&&(b=a,a=""),Error.call(this,b),this.name="ShowError",this.operation=a};return b.prototype=new Error,b.prototype.constructor=b,a.prototype={from:function(a){for(this.properties=a.split("."),this.index=-1,this.lastIndex=this.properties.length-1;++this.index<=this.lastIndex;){if(!this.data.hasOwnProperty(this.properties[this.index]))throw this.e=new b("from","traverse failed because property "+this.properties[this.index]+" not found"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;this.data=this.data[this.properties[this.index]]}return this},remove:function(a){if(!a)throw this.e=new b("remove","remove failed because key not defined"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;if(!this.data.hasOwnProperty(a))throw this.e=new b("remove","remove failed because key does not exist"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;return delete this.data[a],this},insert:function(a){if(!a)throw this.e=new b("insert","insert failed because key not defined"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;if(this.data.hasOwnProperty(a))throw this.e=new b("insert","insert failed because key already exist"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;return this.data[a]="",this},where:function(a){var c,d,e,f,g,h,i=[],j=[],k=Object.keys(a).length;if(!a)throw this.e=new b("where","where failed because query is not defined"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;if(!this.is(this.data,"array"))throw this.e=new b("where","where failed because data is object"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;if(!this.is(a,"object"))throw this.e=new b("where","where failed because query is malformed"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;for(h=this.data.length,g=0;h>g;g+=1){i.length=0;for(c in a)a.hasOwnProperty(c)&&(d=a[c].search(/(&&)/)>-1?"and":a[c].search(/([||])/)>-1?"or":null,d?"and"===d?(e=a[c].split(" && ")[0],f=a[c].split(" && ")[1],a[g][c]===e&&a[g][c]===f&&i.push("found")):"or"===d&&(e=a[c].split(" || ")[0],f=a[c].split(" || ")[1],(a[g][c]===e||a[g][c]===f)&&i.push("found")):this.data[g][c]===a[c]&&i.push("found"));i.length===k&&j.push(this.data[g])}return this.data=j.length<2?j[0]:j,this},set:function(a){var c,d,e;if(!a)throw this.e=new b("set","set failed because no data was provided"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;for(c in a)if(a.hasOwnProperty(c))if(this.is(this.data,"array"))for(e=this.data.length,d=0;e>d;d+=1){if(!this.data[d].hasOwnProperty(c))throw this.e=new b("set","set failed because key "+c+" was not found"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;this.data[d][c]=a[c]}else{if(!this.data.hasOwnProperty(c))throw this.e=new b("set","set failed because key "+c+" was not found"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;this.data[c]=a[c]}return this},sort:function(a,c,d){if(3!==arguments.length)throw this.e=new b("sort","sort failed because too few arguments defined"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;if(!this.is(this.data,"array"))throw this.e=new b("sort","sort failed because data is not an array"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;return this.data.sort(function(){var b;return b="asc"===d?function(b,d){var e;return e="string"===c?b[a].toLowerCase()<d[a].toLowerCase()?-1:b[a].toLowerCase()>d[a].toLowerCase()?1:0:b[a]<d[a]?-1:b[a]>d[a]?1:0}:function(b,d){var e;return e="string"===c?d[a].toLowerCase()<b[a].toLowerCase()?-1:d[a].toLowerCase()>b[a].toLowerCase()?1:0:d[a]<b[a]?-1:d[a]>b[a]?1:0}}),this},select:function(a,b){var c;return c=a?b?this.root[b]:this.root:b?this.data[b]:this.data},is:function(a,b){return Object.prototype.toString.call(a)==="[object "+(b.charAt(0).toUpperCase()+b.slice(1))+"]"}},function(b){return new a(b)}});
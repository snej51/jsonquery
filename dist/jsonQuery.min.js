/*! jsonQuery 11-03-2014 */
!function(a){"use strict";"function"==typeof define&&define.amd?define(a):"object"==typeof exports?module.exports=a:a(window)}(function(a){"use strict";var b=function(a,b){this.data=a||{},this.properties=null,this.root=a||{},this.options=b||{}},c=function(a,b){1===arguments.length&&(b=a,a=""),Error.call(this,b),this.name="ShowError",this.operation=a};return c.prototype=new Error,c.prototype.constructor=c,b.prototype={select:function(a){for(this.properties=a.split("."),this.index=-1,this.lastIndex=this.properties.length-1;++this.index<=this.lastIndex;){if(!this.data.hasOwnProperty(this.properties[this.index]))throw this.e=new c("select","traverse failed because property "+this.properties[this.index]+" not found"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;if(this.is(this.data[this.properties[this.index]],"array")&&this.index<=this.lastIndex)throw this.e=new c("select","traverse failed because path contains array"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;this.data=this.data[this.properties[this.index]]}return this},remove:function(a){if(!a)throw this.e=new c("remove","remove failed because key not defined"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;if(!this.data.hasOwnProperty(a))throw this.e=new c("remove","remove failed because key does not exist"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;return delete this.data[a],this},insert:function(a){if(!a)throw this.e=new c("insert","insert failed because key not defined"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;if(this.data.hasOwnProperty(a))throw this.e=new c("insert","insert failed because key already exist"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;return this.data[a]="",this},where:function(a){var b,d,e,f,g,h,i=[],j=[],k=Object.keys(a).length;if(!a)throw this.e=new c("where","where failed because query is not defined"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;if(!this.is(this.data,"array"))throw this.e=new c("where","where failed because data is object"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;if(!this.is(a,"object"))throw this.e=new c("where","where failed because query is malformed"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;for(h=this.data.length,g=0;h>g;g+=1){i.length=0;for(b in a)a.hasOwnProperty(b)&&(d=a[b].search(/(&&)/)>-1?"and":a[b].search(/([||])/)>-1?"or":null,d?"and"===d?(e=a[b].split(" && ")[0],f=a[b].split(" && ")[1],a[g][b]===e&&a[g][b]===f&&i.push("found")):"or"===d&&(e=a[b].split(" || ")[0],f=a[b].split(" || ")[1],(a[g][b]===e||a[g][b]===f)&&i.push("found")):this.data[g][b]===a[b]&&i.push("found"));i.length===k&&j.push(this.data[g])}return this.data=j,this},set:function(a){var b;if(!a)throw this.e=new c("set","set failed because no data was provided"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;for(b in a)if(a.hasOwnProperty(b)){if(!this.data.hasOwnProperty(b))throw this.e=new c("set","set failed because key "+b+" was not found"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;this.data[b]=a[b]}return this},sort:function(a,b,d){if(3!==arguments.length)throw this.e=new c("sort","sort failed because too few arguments defined"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;if(!this.is(this.data,"array"))throw this.e=new c("sort","sort failed because data is not an array"),this.e.failedAt=this.properties.slice(0,this.index+1).join("."),this.e;return this.data.sort(function(){var c;return c="asc"===d?function(c,d){var e;return e="string"===b?c[a].toLowerCase()<d[a].toLowerCase()?-1:c[a].toLowerCase()>d[a].toLowerCase()?1:0:c[a]<d[a]?-1:c[a]>d[a]?1:0}:function(c,d){var e;return e="string"===b?d[a].toLowerCase()<c[a].toLowerCase()?-1:d[a].toLowerCase()>c[a].toLowerCase()?1:0:d[a]<c[a]?-1:d[a]>c[a]?1:0}}),this},result:function(a,b){var c;return c=a?b?this.root[b]:this.root:b?this.data[b]:this.data},is:function(a,b){return Object.prototype.toString.call(a)==="[object "+(b.charAt(0).toUpperCase()+b.slice(1))+"]"}},a?void(a.JsonQuery=b):b});